<!DOCTYPE html lang="en-UK">
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Atlas del Censo de Escuelas, maestros y alumnos de educacion basica y especial</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="js/chosen.jquery.min.js" charset="utf-8"></script>
		<script src="js/geostats.min.js"></script>
		<script src="js/municipios.json"></script>
		<script src="js/variables2.js" charset="utf-8"></script>
		<link rel="stylesheet" href="js/chosen.min.css" />
		<link rel="stylesheet" href="js/geostats.css" />
		<link href="https://code.jquery.com/ui/1.11.1/themes/redmond/jquery-ui.css" rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<style type="text/css" media="screen">
		
body {
    margin: 0;
    padding: 0;
    font: 14px/20px 'Open Sans', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
    font-family: 'Open Sans';    
    overflow: hidden;
}

#header {
    font-size: 40px;
    width: 100%;
    background-color: #3b6858;
    color: #fff;
    text-align: left;
    line-height: 52px;
    padding-left: 20px;
    font-weight: 300;
}

#header a {
    text-decoration: none;
}

#map {
    position: absolute;
    width: 100%;
    top: 0;
    bottom: 0;
    overflow: hidden;
}

 
#legend {
	font-family: 'Open Sans', serif;
	width: 220px;
	padding: 5px 5px;
	color: #000;
	text-align: center;
	 display: inline-block;
}
.legend-box {
	float: left;
	margin-left: 5px;
	line-height: 11px;
	height: 20px;
	width: 35px;
	font-size: 8px;
	color: #999;
	border: 1px solid #fff;
}

#datos_mun {
    background-color: #fff;
	font-family: 'Open Sans', serif;
    position: absolute;
    top: 20px;
    right: 20px;
    width: 225px;
}

.mundata-box {
    border-bottom: 1px solid #eee;
    position: relative;
    height: 80px;
}

#datos_mun .nom_mun {
    background-color: #009966;
    font-size: 14px;
    padding: 5px 10px;
    font-weight: 400;
    color: #fff;
}

#datos_mun .box-title {
    padding: 5px 10px;
    font-size: 12px;
    text-transform: uppercase;
}

.mundata-box .span-obs, .mundata-box .span-sal, .mundata-box .span-total  {
    color: #009966;
    padding: 2px 10px;
    font-weight: 400;
    font-size: 18px;
}

.mundata-box .span-aseg {
	margin-top: 8px;
}

.state_box {
	background-color: #66c2a4;
	height:69px !important;
	color: #fff;
}
.state_name {
	position: absolute;
	left: 90px;
	top: 15px;
	font-size: 11px;
	text-transform: uppercase;
	font-weight: 700;
	width: 200px;
}
.state_image {
	padding-top: 3px;
	margin-left: 15px;
}
.num_mun {
	position: absolute;
	left: 90px;
	top: 30px;
	font-size: 11px;
}

.datos-title2 {
    background-color: #009966;
    padding: 5px 10px;
    font-size: 12px;
    font-weight: 700;
    text-align: left;
    color: #fff;
}

#types2, #cuestionario {
	width: 225px;
    background-color: #fff;
    z-index: 1999;
    position: absolute;
    right: 20px;
    top: 480px;
    font-family: "Roboto", serif;
}

.span-poder {
    position: absolute;
}
.state_image {
	padding-top: 3px;
	margin-left: 15px;
}

#types, #cuestionario {
	width: 260px;
    background-color: #fff;
    z-index: 1999;
    position: absolute;
    left: 10px;
    top: 80px;
	font-family: 'Open Sans', serif;
}
#filters {
    z-index: 100;
    position: absolute;
    left: 10px;
    bottom: 10px;
}
.filter-button {
	padding: 2px 5px;
	background-color: #009966;
	margin: 3px;
    font-size: 14px;
    line-height: 24px;
    color: #fff;
    float: left;
}
.filter-button:hover, .filter-selected {
	color: #222;
	background-color: #eefff9;
}
.varname {
    padding: 5px 10px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
    line-height: 24px;
    font-weight: 400;
    color: #3b6858;
}
.varlist-header {
	background-color: #eefff9;
	padding: 5px 10px;
    font-size: 14px;
    line-height: 24px;
    font-weight: 400;
    color: #222;
}
.titulo {
    background-color: #009966;
	padding: 5px 10px;
    font-size: 20px;
    text-align: center;
    line-height: 24px;
    font-weight: 400;
    color: #fff;
}



.agency {
    padding: 1px 10px;
}

.nombre-type-selected, .nombre-cuestionario-selected {
	color: #009966;
	font-weight: bold;
       
	
}

.chosen-container {
	margin-bottom: 5px;
}

#types .chosen-single, #cuestionario .chosen-single {
	border: none;
	background: #009966;
	color: #fff;
	box-shadow: none;
	text-shadow: none;
	border-radius: 0px !important;
	padding: 5px 10px;
	font-size: 12px;
	font-weight: 300;
}
#types .chosen-container .chosen-results li.highlighted, #cuestionario .chosen-container .chosen-results li.highlighted {
	background: #009966;
}

#loading {
	  font-family: 'Open Sans', serif;
  	  font-size: 18px;
      font-weight: 400;
      padding: 25px;
	  position: absolute;
	  left: 0;
	  top: 45%;
	  right: 0;
	  margin: 0 auto;
	  z-index: 1000;
	  background-color: #222;
	  color: #fff;
	  text-align: center;
	  width: 200px;
	  border-radius: 20px;
	  display: none;
  }

#agency-select-wrapper {
    position: absolute;
    left: 10px;
    bottom: -325px;
    z-index: 3000;
    background-color: #fff;
}

.datos-title {
    font-family: "Roboto", sans-serif;
    background-color: #009966;
    padding: 5px 10px;
    font-size: 12px;
    font-weight: 700;
    text-align: left;
    color: #fff;
}

.varname {
    padding: 2px 10px;
    border-bottom: 1px solid #eee;
    font-size: 12px;
    line-height: 24px;
    font-weight: bold;
}

.nombre-variable-selected, .nombre-agency-selected, .nombre-type-selected,.nombre-cuestionario-selected {
	color: #009966;
}
.varname:hover {
    background-color: rgb(228,211,233);
}

.agency {
    padding: 1px 10px;
}

#datos .values {
    float: right;
    font-weight: 700;
    font-size: 13px;
}

#datos {
    width: 300px;
    background-color: #fff;
    z-index: 2000;
    position: absolute;
    left: 10px;
    top: 300px;
    font-family: "Roboto", serif;
}

.current-variable {
	padding: 10px;
	font-weight: 700px;
	border-bottom: 1px solid #eee;
}

		</style>
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
		<script src="js/jquery.ui.labeledslider.js"></script>
	</head>
	<body>
		<div id="loading">Cargando datos...</div>


		<div id="map"></div>


		
		
		<div id="agency-select-wrapper">
				<div onmousedown='toggle_categorias();' id="categorias-list" class="datos-title">Preguntas (mostrar)</div>
				<div onmousedown='change_category("al");' id="al" class="varname agency nombre-agency-selected">
¿QUÉ NIVEL O TIPO EDUCATIVO SE IMPARTE EN ESTE CENTRO DE TRABAJO?
</div>
				<div onmousedown='change_category("rezedu");' id="p2" class="varname agency nombre-agency-selected">
¿QUÉ SERVICIO O MODALIDAD PRESTA ESTE CENTRO DE TRABAJO?
</div>
				<div onmousedown='change_category("salud");' id="salud" class="varname agency nombre-agency-selected">
¿EN QUÉ TURNO OFRECE ESTE SERVICIO?
</div>

				<div onmousedown='change_category("p7");' id="p7" class="varname agency nombre-agency-selected">¿EL ALUMNO(A) HABLA ALGUNA LENGUA INDÍGENA?</div>
				<div onmousedown='change_category("p9");' id="p9" class="varname agency nombre-agency-selected"> ¿EL ALUMNO(A) TAMBIÉN HABLA ESPAÑOL? EN CASO DE HABLAR LENGUA INDÍGENA</div>
				<div onmousedown='change_category("p10");' id="p10" class="varname agency">REGULARMENTE, ¿CÓMO SE TRASLADA EL ALUMNO(A) DE SU CASA A LA ESCUELA?
</div>
				<div onmousedown='change_category("p11");' id="p11" class="varname agency">REGULARMENTE, ¿CUÁNTO TIEMPO HACE EL ALUMNO(A) EN LLEGAR DE SU CASA A LA ESCUELA?
</div>
				<div onmousedown='change_category("p12");' id="p12" class="varname agency">BECAS O APOYOS A LA EDUCACIÓN QUE RECIBE EL ALUMNO(A)</div>
				<div onmousedown='change_category("p13");' id="p13" class="varname agency">¿EL ALUMNO(A) TIENE ACCESO A INTERNET EN:?</div>
				<div onmousedown='change_category("p14");' id="p14" class="varname agency"> ¿EL ALUMNO(A) RECIBE ALGUNO DE LOS SIGUIENTES SERVICIOS DE EDUCACIÓN ESPECIAL?
</div>
				
				<div onmousedown='change_category("p16");' id="p16" class="varname agency"> ¿EL ALUMNO (A) RECIBE ALGÚN SERVICIO DE EDUCACIÓN ESPECIAL POR TENER APTITUDES SOBRESALIENTES?
</div>

<div onmousedown='change_category("p17");' id="p17" class="varname agency"> INDIQUE SI EL ALUMNO(A) TIENE ALGUNA DE LAS SIGUIENTES CONDICIONES FÍSICAS, MENTALES O INTELECTUALES

</div>
				
                                
		</div>

		<div id="datos">
		</div>





		
		
		


<div id="types2">
                        <div id="categorias-list" class="datos-title2">Ver por:</div>
			<div onmousedown="change_var_map('total')" id="filter-total" class="varname types">Total Alumnos Censados</div>
			<div onmousedown="change_var_map('sal')" id="filter-sal" class="varname types   nombre-type-selected">Porcentaje de Alumnos</div>
			<div onmousedown="change_var_map('obs')" id="filter-obs" class="varname types">Alumnos en esta Categoria</div>

		</div>   


		<div id="datos_mun">
			<div class="nom_mun">Pase el cursor sobre un municipio...</div>
			<div class="mundata-box state_box">
				<div class="state_image"></div>
				<div class="state_name"></div>
				<div class="num_mun"></div>
			</div>
			<div class="mundata-box">
				<div id="totalalumnos" class="box-title">Total alumnos censados:</div>
				<div id="var-total" class="span-total">--</div>
			</div>
			<div class="mundata-box">
				<div class="box-title">Alumnos en esta categoria:</div>
				<div id="var-obs" class="span-obs span-aseg">--</div>
			</div>
			<div class="mundata-box">
				<div class="box-title">Porcentaje del total:</div>
				<div id="var-sal" class="span-sal">--</div>
			</div>
			<div id="legend" style="display: block;">
				<div style="background-color: #fff; border: 1px solid #f2f2f2;" class="legend-box"></div>
				<div style="background-color: #bae4b3; border: 1px solid #b2e2e2;" class="legend-box"></div>
				<div style="background-color: #74c476; border: 1px solid #66c2a4;" class="legend-box"></div>
				<div style="background-color: #31a354; border: 1px solid #2ca25f;" class="legend-box"></div>
				<div style="background-color: #006d2c; border: 1px solid #006d2c;" class="legend-box"></div>
				<div id="legend-1" class="legend-box">--</div>
				<div id="legend-2" class="legend-box">--</div>
				<div id="legend-3" class="legend-box">--</div>
				<div id="legend-4" class="legend-box">--</div>
				<div id="legend-5" class="legend-box">--</div>
				<div style="clear:both;"></div>
			</div>
		</div>
		<script type="text/javascript" charset="utf-8">

		

 
   
			$(".chosen-select").chosen({width: "240px"});
		
			
					

			function commaSeparateNumber(val){
			    while (/(\d+)(\d{3})/.test(val.toString())){
			      val = val.toString().replace(/(\d+)(\d{3})/, '$1'+','+'$2');
			    }
			    return val;
			  }
			   
			var c_data = null;
			var map_data;
			var c_var = "sal";
			var breaks;
			var categorias_visible = false;



function change_category(cat_name) {
		    		if (categorias_visible == true) toggle_categorias();
			    $(".agency").removeClass("nombre-agency-selected");
				$("#"+cat_name).addClass("nombre-agency-selected");
				
				$("#datos").empty();
				$("#datos").append('<div class="datos-title varlist-title">Pregunta: '+$(".nombre-agency-selected").text()+'</div>');
				$("#datos").append('<div class="current-variable" id="check"></div>');
				$("#datos").append('<select id="preguntas" data-placeholder="Elija una variable..." class="chosen-select">');
				$.each(variables[cat_name], function (key, data) {
					$("#datos select").append('<option value='+cat_name+"_"+data.variable+' id="varbutton-'+cat_name+"_"+data.variable+'">'+data.desc+'</option>');
				});
				$("#datos").append('</select>');
				$(".chosen-select").chosen({width: "280px"});
				$(".current-variable").html(variables[cat_name][0].desc);
				$(".chosen-container-single .chosen-single span").html("Elija una variable...");
				c_cat = cat_name;
				var_root = variables[cat_name][0].variable;
			        change_var();
				$(".chosen-select").change(function(evt, params) {
					$(".current-variable").html($(this).find("option:selected").text());
					$(".chosen-container-single .chosen-single span").html("Elija una variable...");
					
				});
				change_var();
				$( "select.chosen-select" ).trigger("chosen:updated").change( function () { change_var(); });

		   	 }


			function change_type(type) {
		    	$(".types").removeClass("nombre-type-selected");
		    	$("#"+type).addClass("nombre-type-selected");
		    	c_type = type;
			change_var();
						    
		    	}
		    	


			var nacional = {};
			
			var fillColors = ["#bae4b3", "#74c476", "#31a354", "#006d2c"];
			
			var entidades_list = ["", "Aguascalientes", "Baja California", "Baja California Sur", "Campeche", "Coahuila", "Colima", "Chiapas", "Chihuahua", "Distrito Federal", "Durango", "Guanajuato", "Guerrero", "Hidalgo", "Jalisco", "México", "Michoacán", "Morelos", "Nayarit", "Nuevo León", "Oaxaca", "Puebla", "Querétaro", "Quintana Roo", "San Luis Potosí", "Sinaloa", "Sonora", "Tabasco", "Tamaulipas", "Tlaxcala", "Veracruz", "Yucatán", "Zacatecas"];
			var entidades_count_mun = [0,11,5,5,11,38,10,118,67,16,39,46,81,84,125,125,113,33,20,51,570,217,18,9,58,18,72,17,43,60,212,106,58];
			
			function change_var_map(v) {
				$(".types").removeClass("nombre-type-selected");
				$("#filter-"+v).addClass("nombre-type-selected");
				c_var = v;
				change_var();
			}
			
			function fill(n) {
				if (n >= breaks[3]) return "#006d2c";
				else if (n >= breaks[2]) return "#31a354";
				else if (n >= breaks[1]) return "#74c476";
				else if (n == -1) return "#fff";
				else return "#bae4b3";
			}
			function stroke(n) {
				if (n >= breaks[3]) return "#006d2c";
				else if (n >= breaks[2]) return "#2ca25f";
				else if (n >= breaks[1]) return "#66c2a4";
				else if (n == -1) return "#fff";
				else return "#b2e2e2";
				
			}
			
			function map_style(feature) {
		        if (c_var == "MORT") {
			        return {
				        weight: 0.25,
				        opacity: 0.5,
				        color: mortalidad_stroke(feature.properties.MORT),
				        fillOpacity: 0.5,
				        fillColor: mortalidad_fill(feature.properties.MORT)
			        }
		        }
			}


			function toggle_categorias() {
				if (categorias_visible == false) {
					$("#agency-select-wrapper").animate({
						bottom: "0px",
					}, 500);
					$("#categorias-list").html("Preguntas (ocultar)");
					categorias_visible = true;
				}
				else {
					$("#agency-select-wrapper").animate({
						bottom: "-325px",
					}, 500);
					$("#categorias-list").html("Preguntas (mostrar)");
					categorias_visible = false;
				}
			
			}

			
			
			function change_var() {
				$("#loading").show();			
				$.getJSON( "php/attributes2.php", { edad: $("#edad option:selected").val(), sector: $("#sector option:selected").val(), sexo: $("#sexo option:selected").val(), year: $("#year option:selected").val(), tamano: $("#tamano option:selected").val(), pregunta: $("#preguntas option:selected").val() } )
					.done(function( json ) {	
						var values = [];
						$.each( municipios.features, function( mid, municipio ) {
							if (typeof json[municipio.properties.CVE_INEGI] != 'undefined') {
								municipio.properties.obs = parseInt(json[municipio.properties.CVE_INEGI].obs);
								municipio.properties.sal = parseInt(json[municipio.properties.CVE_INEGI].sal);
								municipio.properties.total = parseInt(json[municipio.properties.CVE_INEGI].total);
								values.push(parseInt(json[municipio.properties.CVE_INEGI][c_var]));
							}
							else {
								municipio.properties.obs = -1;
								municipio.properties.sal = -1;
								municipio.properties.total = -1;
							}
						});
						if (parseInt(json["99999"]["obs"]) != -1) nacional["obs"] = json["99999"]["obs"];
						else nacional["obs"] = "N/A";
						if (parseInt(json["99999"]["sal"]) != -1) nacional["sal"] = json["99999"]["sal"];
						else nacional["sal"] = "N/A";
						if (parseInt(json["99999"]["total"]) != -1) nacional["total"] = json["99999"]["total"];
						else nacional["total"] = "N/A";

						var gs = new geostats(values);
						breaks = gs.getClassJenks(4);
						gs.setColors(fillColors);
						gs.setPrecision(0);
						$("#legend-1").html("N/A");
						$("#legend-2").html("&lt; " + commaSeparateNumber(breaks[1]));
						$("#legend-3").html(commaSeparateNumber(breaks[1]) + " - " + commaSeparateNumber(breaks[2]));
						$("#legend-4").html(commaSeparateNumber(breaks[2]) + " - " + commaSeparateNumber(breaks[3]));
						$("#legend-5").html(commaSeparateNumber(breaks[3]) + " - " + commaSeparateNumber(breaks[4]));
						
						if (map_data != null) map.removeLayer(map_data);
						map_data = L.geoJson(municipios, {
							style: function(feature) {
								return {
							        weight: 0.25,
							        opacity: 0.5,
							        color: stroke(feature.properties[c_var]),
							        fillOpacity: 0.5,
							        fillColor: fill(feature.properties[c_var])
						        }
							},
							onEachFeature: onEachFeature
						})
						
						map.addLayer(map_data);					
						$("#loading").hide();
				});
				
				
		    }
			
			var map = new L.Map('map', {
				maxZoom: 14,
				minZoom: 5
			}).setView(new L.LatLng(21.25,-101.5),5);
			map.scrollWheelZoom.disable();
			
			var baseLayer = new L.TileLayer("http://{s}.google.com/vt/?hl=en&x={x}&y={y}&z={z}&s={s}&apistyle=p.s%3A-100%2Cs.t%3A1314%7Cp.v%3Aoff%2Cs.t%3A6%7Cp.l%3A31%2Cs.t%3A3%7Cp.v%3Aoff%2Cs.t%3A18%7Cp.v%3Aoff%2Cs.t%3A2%7Cp.v%3Aoff%2Cs.t%3A5%7Cp.l%3A47%2Cs.t%3A20%7Cp.v%3Aoff%2Cs.t%3A4%7Cp.v%3Aoff%2Cs.t%3A5%7Cs.e%3Al%7Cp.v%3Aoff&style=47,37%7Csmartmaps", {
				subdomains: ['mt0','mt1','mt2','mt3'],
				detectRetina: 'true',
				attribution: "Basemap © 2014 Google",
				zIndex: -1
			});
			map.addLayer(baseLayer);
			
			var entidades = new L.TileLayer.WMS("/geoserver/geom/wms", {
				layers: 'geom:entidades',
				transparent: 'true',
				format: 'image/png',
				opacity: '0.5',
				tiled: 'true',
				detectRetina: 'true',
				zIndex: 200
			});
	        map.addLayer(entidades);
	        
	        function onEachFeature(feature, layer) {
				layer.on({
					mouseover: function () {
						c_data = feature.properties;
						console.log(c_data);
						$(".nom_mun").html(c_data.NOM_MUN + ", " + c_data.NOM_ENT);
						$(".state_name").html(entidades_list[parseInt(c_data.CVE_ENT)]);
						$(".num_mun").html(entidades_count_mun[parseInt(c_data.CVE_ENT)] + " municipios");
						$(".state_image").html("<img src='img/estados/"+parseInt(c_data.CVE_ENT)+".png' />");
						if (c_data["obs"] != -1) $(".span-obs").html(commaSeparateNumber("Municipio " + c_data["obs"]) +
						"<br/>Nacional: "+ commaSeparateNumber(nacional["obs"]) + "<br/>");
						else $(".span-obs").html("N/A" + "<br/>("+ commaSeparateNumber(nacional["obs"]) + ")<br/>");

						if (c_data["total"] != -1) $(".span-total").html(commaSeparateNumber("Municipio " + c_data["total"]) +
						"<br/>Nacional: "+ commaSeparateNumber(nacional["total"]) + "<br/>");
						else $(".span-total").html("N/A" + "<br/>("+ commaSeparateNumber(nacional["total"]) + ")<br/>");

						if (c_data["sal"] != -1) $(".span-sal").html( commaSeparateNumber("Municipio " + c_data["sal"]) + "%" + "<br/>Nacional: "+ commaSeparateNumber(nacional["sal"]) + "%");
						else $(".span-sal").html("N/A" + "<br/>(%"+ commaSeparateNumber(nacional["sal"]) + ")");
						
					}
				});
			}
			
			change_category("p13");			
			$( "select.chosen-select" ).trigger("chosen:updated").change( function () { change_var(); });




			

		    
		</script>

	</body>

</html>
